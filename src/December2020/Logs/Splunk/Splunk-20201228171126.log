2020-12-28 17:11:27.062 +00:00 [VRB] Started SANS Holiday Hack, December 2020
2020-12-28 17:11:27.080 +00:00 [VRB] Using CTF runner 0.1.0-alpha.19
2020-12-28 17:11:27.083 +00:00 [VRB] Running challange Splunk
2020-12-28 17:11:27.084 +00:00 [INF] Splunk url taken from java script page... before becomming Santa
https://splunk.kringlecastle.com/en-US/account/insecurelogin?username=santa&password=2f3a4fccca6406e35bcf33e92dd93135
2020-12-28 17:11:27.084 +00:00 [INF] Random searches

                | tstats count where index=* by index
                | metadata index=attack type=hosts

                index=attack

                index=attack | fields Technique | uniq

                index= * | mitremap

                | tstats values(sourcetypes) where index=*

                index=* sourcetype=wineventlog



                | metadata type=sourcetypes index=*

            
2020-12-28 17:11:27.085 +00:00 [INF] | metadata type=sourcetypes index=*

	                firstTime	lastTime	recentTime	sourcetype	totalCount	type
                1	1606762640	1606770257	1606770258	WinEventLog	10283	sourcetypes
                2	1606762873	1606769955	1606770075	wineventlog	220669	sourcetypes
                3	1606762638	1606770232	1606770234	xmlwineventlog	42499	sourcetypes
                4	1606758856	1606770255	1606770259	bro:conn:json	13921	sourcetypes
                5	1606762029	1606769631	1606769631	bro:dns:json	44	sourcetypes
                6	1606761928	1606770250	1606770252	bro:files:json	5812	sourcetypes
                7	1606762801	1606770250	1606770252	bro:http:json	2597	sourcetypes
                8	1606761921	1606770230	1606770236	bro:rdp:json	2363	sourcetypes
                9	1606763121	1606769601	1606769602	bro:smb_files:json	2	sourcetypes
                10	1606763121	1606769635	1606769635	bro:smb_mapping:json	8	sourcetypes
                11	1606769219	1606769219	1606769479	bro:software:json	1	sourcetypes
                12	1606761926	1606770230	1606770230	bro:ssl:json	2725	sourcetypes
                13	1606761927	1606770230	1606770230	bro:x509:json	2722	sourcetypes
                14	1606754786	1606769951	1606770027	csv	68	sourcetypes

            
2020-12-28 17:11:27.093 +00:00 [INF] | tstats count where index=* by index

	                index	count
                1	attack	68
                2	t1033-main	3311
                3	t1033-win	21734
                4	t1057-win	18006
                5	t1059.003-main	1984
                6	t1059.003-win	18519
                7	t1059.005-main	1758
                8	t1059.005-win	18852
                9	t1071.001-main	2795
                10	t1071.001-win	20718
                11	t1082-win	18136
                12	t1105-main	1938
                13	t1105-win	15424
                14	t1106-main	1611
                15	t1106-win	18720
                16	t1123-main	4281
                17	t1123-win	20488
                18	t1204.002-main	1342
                19	t1204.002-win	20033
                20	t1547.001-main	1833
                21	t1547.001-win	19490
                22	t1548.002-main	7018
                23	t1548.002-win	21499
                24	t1559.002-main	2324
                25	t1559.002-win	22144
                26	t1566.001-win	19688
            
2020-12-28 17:11:27.095 +00:00 [INF] How many distinct MITRE ATT & CK techniques did Alice emulate? 13


                Manual: 
                Count distinct from index list: t1033,t1057,t1059,t1071,t1082,t1105,t1106,t1123,t1204,t1547,t1548,t1559,t1566


                Hint from chat: 
                The search I used was:

                | tstats count where index=* by index 
                | search index=T*-win OR T*-main
                | rex field=index "(?< technique > t\d +)[\.\-].0 * " 
                | stats dc(technique)


            
2020-12-28 17:11:27.097 +00:00 [INF] What are the names of the two indexes that contain the results of emulating Enterprise ATT&CK technique 1059.003 ? (Put them in alphabetical order and separate them with a space) t1059.003-main t1059.003-win

                t1059.003-main t1059.003-win
            
2020-12-28 17:11:27.098 +00:00 [INF] One technique that Santa had us simulate deals with 'system information discovery'. What is the full name of the registry key that is queried to determine the MachineGuid? HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography

                index=* "system information discovery"

                Goggle "system information discovery mirte"

                https://attack.mitre.org/techniques/T1082/
                https://atomicredteam.io/
                https://github.com/redcanaryco/atomic-red-team/tree/master/atomics 

                From: 

                https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md

                Atomic Test #8 - Windows MachineGUID Discovery
                Identify the Windows MachineGUID value for a system. Upon execution, the machine GUID will be displayed from registry.

                Supported Platforms: Windows

                Attack Commands: Run with command_prompt!
                REG QUERY HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography /v MachineGuid

            
2020-12-28 17:11:27.102 +00:00 [INF] According to events recorded by the Splunk Attack Range, when was the first OSTAP related atomic test executed? (Please provide the alphanumeric UTC timestamp.) 2020-11-30T17:44:15Z

                index=* OSTAP | sort +_time

                "2020-11-30T17:44:15Z","2020-11-30T17:44:15","T1105","11","OSTAP Worming Activity","win-dc-748","attackrange\administrator","2ca61766-b456-4fcf-a35a-1233685e1cad"

              
            
2020-12-28 17:11:27.162 +00:00 [INF] One Atomic Red Team test executed by the Attack Range makes use of an open source package authored by frgnca on GitHub. According to Sysmon (Event Code 1) events in Splunk, what was the ProcessId associated with the first use of this component? 3648

                index=* EventCode=1
                index=* ProcessID=*

                index=* ProcessID=* | stats dc(ProcessID) by ProcessID

                index=* ProcessId=* | stats dc(ProcessId) by ProcessId
                index=* ProcessId=* EventCode=1 "Microsoft-Windows-Sysmon" | stats dc(ProcessId) by ProcessId

                index=T* ProcessId=* EventCode=1 "Microsoft-Windows-Sysmon" | stats list(ProcessId) by ProcessId

                100
                1016
                1020
                1040
                1048
                1076
                1080
                1084
                1092
                1096
                1124
                1128
                1132
                1140
                1144
                1176
                1180
                1184
                1244
                1248
                1300
                1320
                1356
                136
                1400
                1448
                1460
                1476
                1480
                1484
                1492
                1496
                1500
                1508
                1516
                1528
                1556
                1560
                1572
                1600
                1644
                1648
                1660
                1664
                1692
                1696
                1700
                1708
                172
                1724
                1760
                1768
                1772
                1776
                1784
                184
                1844
                1856
                1864
                1868
                1892
                1896
                1904
                1908
                1912
                1920
                1936
                1940
                1948
                1952
                1956
                1960
                1964
                1976
                1988
                2008
                2028
                2032    
                2040
                208
                2104
                2148
                2164
                2172
                2184
                2188
                2192
                2200
                2204
                2212
                2232
                224
                2248
                2256
                2264
                2268
                2272
                2284
                2296
                2300
                ... 700ish hits... too many

                https://github.com/frgnca/AudioDeviceCmdlets
                https://github.com/redcanaryco/atomic-red-team/search?q=AudioDeviceCmdlets

                https://github.com/redcanaryco/atomic-red-team/blob/8eb52117b748d378325f7719554a896e37bccec7/atomics/T1123/T1123.md

                index=T1123* ProcessId=* "Microsoft-Windows-Sysmon" EventCode=1


                index=T1123* ProcessId=* "Microsoft-Windows-Sysmon" EventCode=1 powershell.exe -Command WindowsAudioDevice-Powershell-Cmdlet | sort +UtcTime

            
2020-12-28 17:11:27.204 +00:00 [INF] Alice ran a simulation of an attacker abusing Windows registry run keys. This technique leveraged a multi-line batch file that was also used by a few other techniques. What is the final command of this multi-line batch file used as part of this simulation? quser

                Find Atomic Test related to registry run keys...
                https://github.com/redcanaryco/atomic-red-team/search?q=registry+run+keys                
                https://github.com/redcanaryco/atomic-red-team/tree/5ff80f6f90c056b0bfe3a6ffa0f5015f215c56b0/atomics/T1547.001                
                https://github.com/redcanaryco/atomic-red-team/blob/5ff80f6f90c056b0bfe3a6ffa0f5015f215c56b0/atomics/T1547.001/T1547.001.md#atomic-test-6---suspicious-bat-file-run-from-startup-folder

                index=* batstartup.bat
                
                it was not this one... so went to find all bat files in atomice-red-team...
                https://github.com/redcanaryco/atomic-red-team/blob/8eb52117b748d378325f7719554a896e37bccec7/atomics/T1074.001/src/Discovery.bat
                
            
2020-12-28 17:11:27.209 +00:00 [INF] Alice ran a simulation of an attacker abusing Windows registry run keys. This technique leveraged a multi-line batch file that was also used by a few other techniques. What is the final command of this multi-line batch file used as part of this simulation? quser

                Find Atomic Test related to registry run keys...
                https://github.com/redcanaryco/atomic-red-team/search?q=registry+run+keys                
                https://github.com/redcanaryco/atomic-red-team/tree/5ff80f6f90c056b0bfe3a6ffa0f5015f215c56b0/atomics/T1547.001                
                https://github.com/redcanaryco/atomic-red-team/blob/5ff80f6f90c056b0bfe3a6ffa0f5015f215c56b0/atomics/T1547.001/T1547.001.md#atomic-test-6---suspicious-bat-file-run-from-startup-folder

                index=* batstartup.bat
                
                it was not this one... so went to find all bat files in atomice-red-team...
                https://github.com/redcanaryco/atomic-red-team/blob/8eb52117b748d378325f7719554a896e37bccec7/atomics/T1074.001/src/Discovery.bat
                
            
2020-12-28 17:11:27.212 +00:00 [INF] According to x509 certificate events captured by Zeek (formerly Bro), what is the serial number of the TLS certificate assigned to the Windows domain controller in the attack range? 

            
2020-12-28 17:11:27.213 +00:00 [VRB] Challenge Splunk completed
